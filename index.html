<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Advanced mapping application with real-time navigation and routing">
    <meta name="theme-color" content="#ffffff">
    <title>MapVerse - Next Generation Maps</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin="" />
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://tile.openstreetmap.org">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="logo-animation">
                <svg viewBox="0 0 100 100" class="map-logo">
                    <circle cx="50" cy="50" r="45" class="circle-1"/>
                    <circle cx="50" cy="50" r="35" class="circle-2"/>
                    <path d="M50 20 L50 50 L70 70" class="pointer" stroke-linecap="round"/>
                </svg>
            </div>
            <h1 class="loading-title">MapVerse</h1>
            <p class="loading-text">Loading your world...</p>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container hidden">
        <!-- Top Navigation Bar -->
        <header class="top-bar">
            <div class="logo-section">
                <svg viewBox="0 0 100 100" class="logo-icon">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="currentColor" stroke-width="3"/>
                    <path d="M50 20 L50 50 L70 70" stroke="currentColor" stroke-width="4" fill="none" stroke-linecap="round"/>
                </svg>
                <span class="logo-text">MapVerse</span>
            </div>
            
            <!-- Search Bar -->
            <div class="search-container">
                <button class="search-icon-btn" aria-label="Search type">
                    <svg viewBox="0 0 24 24" class="icon">
                        <circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M21 21 L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                <input type="text" id="search-input" class="search-input" placeholder="Search places, addresses..." autocomplete="off">
                <button id="voice-search-btn" class="voice-search-btn" aria-label="Voice search">
                    <svg viewBox="0 0 24 24" class="icon">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" fill="currentColor"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" fill="currentColor"/>
                    </svg>
                </button>
                <div id="search-results" class="search-results hidden"></div>
            </div>

            <!-- Top Actions -->
            <div class="top-actions">
                <button id="theme-toggle" class="icon-btn" aria-label="Toggle theme" title="Toggle Dark/Light Mode">
                    <svg viewBox="0 0 24 24" class="icon theme-icon-light">
                        <circle cx="12" cy="12" r="5" fill="currentColor"/>
                        <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <svg viewBox="0 0 24 24" class="icon theme-icon-dark hidden">
                        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" fill="currentColor"/>
                    </svg>
                </button>
                <button id="settings-btn" class="icon-btn" aria-label="Settings" title="Settings">
                    <svg viewBox="0 0 24 24" class="icon">
                        <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 1v6m0 10v6M4.22 4.22l4.24 4.24m7.08 7.08l4.24 4.24M1 12h6m10 0h6M4.22 19.78l4.24-4.24m7.08-7.08l4.24-4.24" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Sidebar / Desktop Panel -->
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Navigation</h2>
                <button id="close-sidebar" class="icon-btn close-sidebar-btn" aria-label="Close sidebar">
                    <svg viewBox="0 0 24 24" class="icon">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <button id="my-location-btn" class="action-btn primary-btn">
                    <svg viewBox="0 0 24 24" class="icon">
                        <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="12" r="3" fill="currentColor"/>
                    </svg>
                    <span>My Location</span>
                </button>
                <button id="directions-btn" class="action-btn">
                    <svg viewBox="0 0 24 24" class="icon">
                        <path d="M21.71 11.29l-9-9a1 1 0 00-1.42 0l-9 9a1 1 0 000 1.42l9 9a1 1 0 001.42 0l9-9a1 1 0 000-1.42zM14 14.5V12h-4v3H8v-4a1 1 0 011-1h5V7.5l3.5 3.5-3.5 3.5z" fill="currentColor"/>
                    </svg>
                    <span>Get Directions</span>
                </button>
            </div>

            <!-- Travel Mode Selector -->
            <div id="travel-mode-container" class="travel-mode-container hidden">
                <h3 class="section-title">Travel Mode</h3>
                <div class="travel-modes">
                    <button class="travel-mode-btn active" data-mode="driving">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z" fill="currentColor"/>
                        </svg>
                        <span>Drive</span>
                    </button>
                    <button class="travel-mode-btn" data-mode="walking">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path d="M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L6 8.3V13h2V9.6l1.8-.7" fill="currentColor"/>
                        </svg>
                        <span>Walk</span>
                    </button>
                    <button class="travel-mode-btn" data-mode="cycling">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path d="M15.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM5 12c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5zm5.8-10l2.4-2.4.8.8c1.3 1.3 3 2.1 5.1 2.1V9c-1.5 0-2.7-.6-3.6-1.5l-1.9-1.9c-.5-.4-1-.6-1.6-.6s-1.1.2-1.4.6L7.8 8.4c-.4.4-.6.9-.6 1.4 0 .6.2 1.1.6 1.4L11 14v5h2v-6.2l-2.2-2.3zM19 12c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm0 8.5c-1.9 0-3.5-1.6-3.5-3.5s1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5-1.6 3.5-3.5 3.5z" fill="currentColor"/>
                        </svg>
                        <span>Bike</span>
                    </button>
                </div>
            </div>

            <!-- Directions Panel -->
            <div id="directions-panel" class="directions-panel hidden">
                <h3 class="section-title">Route Information</h3>
                <div id="route-summary" class="route-summary"></div>
                <div id="turn-by-turn" class="turn-by-turn"></div>
            </div>

            <!-- Favorites Section -->
            <div class="favorites-section">
                <div class="section-header">
                    <h3 class="section-title">Saved Places</h3>
                    <button id="add-favorite-btn" class="icon-btn" aria-label="Add favorite" title="Save current location">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div id="favorites-list" class="favorites-list"></div>
            </div>

            <!-- Recent Searches -->
            <div class="recent-section">
                <div class="section-header">
                    <h3 class="section-title">Recent Searches</h3>
                    <button id="clear-recent-btn" class="icon-btn" aria-label="Clear recent" title="Clear all">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div id="recent-list" class="recent-list"></div>
            </div>
        </aside>

        <!-- Map Container -->
        <main class="map-wrapper">
            <div id="map" class="map-container"></div>
            
            <!-- Map Overlay Controls -->
            <div class="map-controls">
                <!-- Location Accuracy Indicator -->
                <div id="accuracy-indicator" class="accuracy-indicator hidden">
                    <div class="accuracy-icon">
                        <svg viewBox="0 0 24 24" class="icon">
                            <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="12" r="3" fill="currentColor"/>
                        </svg>
                    </div>
                    <span id="accuracy-text" class="accuracy-text">High accuracy</span>
                </div>

                <!-- Weather Widget -->
                <div id="weather-widget" class="weather-widget hidden">
                    <div class="weather-icon">üå§Ô∏è</div>
                    <div class="weather-info">
                        <div class="weather-temp">--¬∞C</div>
                        <div class="weather-desc">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Floating Action Buttons -->
            <div class="fab-container">
                <button id="fab-main" class="fab fab-main" aria-label="More actions">
                    <svg viewBox="0 0 24 24" class="icon fab-icon-plus">
                        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <svg viewBox="0 0 24 24" class="icon fab-icon-close hidden">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                
                <div id="fab-menu" class="fab-menu hidden">
                    <button id="fab-measure" class="fab fab-sub" aria-label="Measure distance" title="Measure distance">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path d="M21 6H3M21 12H3M21 18H3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="9" cy="6" r="2" fill="currentColor"/>
                            <circle cx="15" cy="18" r="2" fill="currentColor"/>
                        </svg>
                    </button>
                    <button id="fab-share" class="fab fab-sub" aria-label="Share location" title="Share location">
                        <svg viewBox="0 0 24 24" class="icon">
                            <circle cx="18" cy="5" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                            <circle cx="6" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                            <circle cx="18" cy="19" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                            <path d="M8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </button>
                    <button id="fab-nearby" class="fab fab-sub" aria-label="Nearby places" title="Find nearby places">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z" fill="none" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="10" r="3" fill="currentColor"/>
                        </svg>
                    </button>
                    <button id="fab-layers" class="fab fab-sub" aria-label="Map layers" title="Change map style">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Bottom Sheet -->
            <div id="bottom-sheet" class="bottom-sheet">
                <div class="bottom-sheet-handle"></div>
                <div class="bottom-sheet-content">
                    <div id="bottom-sheet-body" class="bottom-sheet-body">
                        <p class="bottom-sheet-hint">Tap on the map to select a destination</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    
    <!-- Share Modal -->
    <div id="share-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Share Location</h3>
                <button class="modal-close" aria-label="Close">
                    <svg viewBox="0 0 24 24" class="icon">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="share-options">
                    <div class="share-item">
                        <label>Coordinates:</label>
                        <div class="share-input-group">
                            <input type="text" id="share-coords" readonly>
                            <button id="copy-coords-btn" class="copy-btn">Copy</button>
                        </div>
                    </div>
                    <div class="share-item">
                        <label>Share Link:</label>
                        <div class="share-input-group">
                            <input type="text" id="share-link" readonly>
                            <button id="copy-link-btn" class="copy-btn">Copy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Nearby Places Modal -->
    <div id="nearby-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nearby Places</h3>
                <button class="modal-close" aria-label="Close">
                    <svg viewBox="0 0 24 24" class="icon">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="nearby-categories">
                    <button class="category-btn" data-category="restaurant">üçΩÔ∏è Restaurants</button>
                    <button class="category-btn" data-category="cafe">‚òï Cafes</button>
                    <button class="category-btn" data-category="fuel">‚õΩ Gas Stations</button>
                    <button class="category-btn" data-category="hospital">üè• Hospitals</button>
                    <button class="category-btn" data-category="pharmacy">üíä Pharmacies</button>
                    <button class="category-btn" data-category="bank">üè¶ Banks</button>
                </div>
                <div id="nearby-results" class="nearby-results"></div>
            </div>
        </div>
    </div>

    <!-- Map Layers Modal -->
    <div id="layers-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Map Styles</h3>
                <button class="modal-close" aria-label="Close">
                    <svg viewBox="0 0 24 24" class="icon">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="layer-options">
                    <button class="layer-btn active" data-layer="standard">
                        <div class="layer-preview layer-standard"></div>
                        <span>Standard</span>
                    </button>
                    <button class="layer-btn" data-layer="satellite">
                        <div class="layer-preview layer-satellite"></div>
                        <span>Satellite</span>
                    </button>
                    <button class="layer-btn" data-layer="terrain">
                        <div class="layer-preview layer-terrain"></div>
                        <span>Terrain</span>
                    </button>
                    <button class="layer-btn" data-layer="dark">
                        <div class="layer-preview layer-dark"></div>
                        <span>Dark</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Permission Request Modal -->
    <div id="permission-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content permission-modal">
            <div class="permission-icon">
                <svg viewBox="0 0 24 24" class="icon">
                    <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                    <circle cx="12" cy="12" r="3" fill="currentColor"/>
                </svg>
            </div>
            <h3 class="modal-title">Enable Location Services</h3>
            <p class="permission-text">MapVerse needs access to your location to provide navigation and nearby place recommendations.</p>
            <div class="permission-actions">
                <button id="allow-location-btn" class="btn btn-primary">Allow</button>
                <button id="deny-location-btn" class="btn btn-secondary">Not Now</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script src="js/storage.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/map.js"></script>
    <script src="js/routing.js"></script>
    <script src="js/search.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
